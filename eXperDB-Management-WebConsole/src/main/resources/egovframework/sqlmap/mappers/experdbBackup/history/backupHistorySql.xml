<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="experdbHistorySql">
	
		<select id="selectJobHistoryList" resultType="backupJobHistoryVO" parameterType="hashmap">
				SELECT 
						RECORDID
						, SERVERNAME
						, TARGETNAME
						, JOBNAME
						, JOBUUID
						, JOBID
						, JOBTYPE 
						, (CASE 
								 when JOBTYPE = 1 then 'Backup'
								 when JOBTYPE = 2 then 'Restore'
								 when JOBTYPE = 3 then 'Full Backup'
							     when JOBTYPE = 4 then 'Incremental Backup'
					     ELSE 'Verify Backup'
						  end) AS JOBTYPE_NM
						, JOBMETHOD
						, DESTINATIONLOCATION
						, ENCRYPTIONALGONAME
						, COMPRESSLEVEL
						, EXECUTETIME
						, FINISHTIME
						, THROUGHPUT
						, WRITETHROUGHPUT
						, WRITEDATA
						, PROCESSEDDATA
						, PROTECTEDDATA
						, RPSHOSTNAME
						, RPSUUID
						, DATASTORENAME
						, DATASTOREUUID
						, SOURCEMACHINENAME
						, SOURCEMACHINEUUID
						, STATUS
						, OPERATIONTYPE
						, SESSIONGUID
				FROM JOBHISTORY
			    WHERE 1=1
			    <if test="server != 0 and server != null and server != ''">
				  AND replace(TARGETNAME,'.','') = #{server}
				</if>
				<if test="type != 0 and type != ''">
				  AND JOBTYPE = #{type}::numeric
			    </if>
			    <if test="status != 0 and status != ''">
				  AND STATUS = #{status}::numeric
				</if>
				  AND EXECUTETIME BETWEEN #{startDate}::numeric AND #{endDate}::numeric	
				ORDER BY JOBID DESC		
		</select>
		
		
		<select id="selectBackupActivityLogList" resultType="backupActivityLogVO"  parameterType="int">
				SELECT 
							RECORDID
							, SERVERNAME
							, TARGETNAME
							, JOBNAME
							, JOBUUID
							, JOBID
							, JOBTYPE
							, TYPE
							, TIME
							, MESSAGE
							, SOURCEMACHINENAME
							, SOURCEMACHINEUUID
							, ERRORCODE
				FROM ACTIVITYLOG
				WHERE JOBID = #{jobid}
		</select>
</mapper>