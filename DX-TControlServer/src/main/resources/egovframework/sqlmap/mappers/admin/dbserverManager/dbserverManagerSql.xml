<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dbserverManagerSql">

	<select id="selectDbServerList" resultType="dbServerVO">
		/**
	 	*  Query ID : selectDbServerList
	 	* Description : DB서버 리스트 조회
	 	* Author : 변승우
	 	**/
	 	
	  SELECT
      		(ROW_NUMBER() OVER()) AS ROWNUM
			, (ROW_NUMBER() OVER()) AS IDX
			, A.DB_SVR_ID
			, A.DB_SVR_NM
			, A.IPADR
			, A.PORTNO
			, A.DFT_DB_NM
			, A.SVR_SPR_USR_ID
			, A.SVR_SPR_SCM_PWD
			, A.FRST_REGR_ID
			, A.FRST_REG_DTM
			, A.LST_MDFR_ID
			, A.LST_MDF_DTM
      FROM(      
          SELECT 
                 DB_SVR_ID
                , DB_SVR_NM
                , IPADR
                , PORTNO
                , DFT_DB_NM
                , SVR_SPR_USR_ID
                , SVR_SPR_SCM_PWD
                , FRST_REGR_ID
                , FRST_REG_DTM
                , LST_MDFR_ID
                , LST_MDF_DTM
          FROM T_DBSVR_I	
          WHERE 1 = 1
          
	      <if test="db_svr_nm != null and db_svr_nm != '' ">
	      AND DB_SVR_NM LIKE '%' || #{db_svr_nm} || '%'
	      </if>	     
	      <if test="ipadr != null and ipadr != '' ">
	      AND IPADR LIKE '%' || #{ipadr} || '%'
	      </if>	      
	      <if test="dft_db_nm != null and dft_db_nm != '' ">
	      AND DFT_DB_NM LIKE  '%' || #{dft_db_nm} || '%'
	      </if>         
          ORDER BY DB_SVR_ID
      ) A		
    </select>
    
    
    <insert id="insertDbServer" parameterType="dbServerVO">
    	/**
	 	*  Query ID : insertDbServer
	 	* Description : insertDbServer 등록
	 	* Author : 변승우
	 	**/
	 	
		INSERT INTO T_DBSVR_I
		(
			  DB_SVR_ID
			, DB_SVR_NM
			, IPADR
			, PORTNO
			, DFT_DB_NM
			, SVR_SPR_USR_ID
			, SVR_SPR_SCM_PWD
			, FRST_REGR_ID
			, FRST_REG_DTM
			, LST_MDFR_ID
			, LST_MDF_DTM
		) 
		VALUES
		(
			  nextval('q_dbsvr_i_01')
			, #{db_svr_nm}
			, #{ipadr}
			, #{portno}
			, #{dft_db_nm}
			, #{svr_spr_usr_id}
			, #{svr_spr_scm_pwd}
			, #{frst_regr_id}
			, clock_timestamp()
			, #{lst_mdfr_id}
			, clock_timestamp()	
		)
	</insert>    
</mapper>
