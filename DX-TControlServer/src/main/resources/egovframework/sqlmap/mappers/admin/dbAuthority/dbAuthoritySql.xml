<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dbAuthoritySql">

	<select id="selectSvrList" resultType="HashMap">
		/**
	 	*  Query ID : selectSvrList
	 	* Description : DB서버 리스트 조회
	 	* Author : 변승우
	 	**/
	  SELECT
      		(ROW_NUMBER() OVER()) AS ROWNUM
			, (ROW_NUMBER() OVER()) AS IDX
			, A.DB_SVR_ID
			, A.DB_SVR_NM
			, A.IPADR
			, A.PORTNO
			, A.DFT_DB_NM
			, A.SVR_SPR_USR_ID
			, A.SVR_SPR_SCM_PWD
			, A.ISTPATH
			, A.FRST_REGR_ID
			, FRST_REG_DTM
			, A.LST_MDFR_ID
			, LST_MDF_DTM
      FROM(      
          SELECT 
                 DB_SVR_ID
                , DB_SVR_NM
                , IPADR
                , PORTNO
                , DFT_DB_NM
                , SVR_SPR_USR_ID
                , SVR_SPR_SCM_PWD
                , ISTPATH
			, FRST_REGR_ID
			, TO_CHAR(FRST_REG_DTM,'YYYY-MM-DD HH24:MI:SS') AS FRST_REG_DTM
			, LST_MDFR_ID
			, TO_CHAR(LST_MDF_DTM,'YYYY-MM-DD HH24:MI:SS') AS LST_MDF_DTM
          FROM T_DBSVR_I	
          WHERE 1 = 1
          ORDER BY DB_SVR_ID
      ) A	
	</select>
	
	
	<insert id="insertUsrDbSvrAut" parameterType="HashMap">
		/**
		* Query ID : insertUsrDbSvrAut
		* Description : 유저디비서버권한 초기등록
		* Author : 변승우
		**/
  			INSERT INTO T_USRDBSVRAUT_I
			(
			USR_DB_SVR_AUT_ID
			, USR_ID
			, DB_SVR_ID
			, BCK_CNG_AUT_YN
			, BCK_HIST_AUT_YN
			, ACS_CNTR_AUT_YN
			, ADT_CNG_AUT_YN
			, ADT_HIST_AUT_YN
			, FRST_REGR_ID
			, FRST_REG_DTM
			, LST_MDFR_ID
			, LST_MDF_DTM
			)
		VALUES
			(			
			nextval('q_usrdbsvraut_i_01')
			, #{user}
			, #{db_svr_id}
			, 'N'
			, 'N'
			, 'N'
			, 'N'
			, 'N'
			, #{usr_id}
			, clock_timestamp()
			, #{usr_id}
			, clock_timestamp()
			)
	</insert>	
	
	
	<select id="selectDBList" resultType="HashMap">
		/**
	 	*  Query ID : selectDBList
	 	* Description : DB 리스트 조회
	 	* Author : 변승우
	 	**/
		SELECT 
			A.DB_SVR_ID
		    , A.DB_SVR_NM
		    , B.DB_ID
		    , B.DB_NM
		FROM T_DBSVR_I A, T_DB_I B
		WHERE 1 = 1
		AND A.DB_SVR_ID = B.DB_SVR_ID
	</select>
	
	
	<insert id="insertUsrDbAut" parameterType="HashMap">
		/**
		* Query ID : insertUsrDbAut
		* Description : 유저디비권한 초기등록
		* Author : 변승우
		**/
  			INSERT INTO T_USRDBAUT_I
			(
			USR_DB_AUT_ID
			, DB_SVR_ID			
			, DB_ID
			, USR_ID		
			, AUT_YN
			, FRST_REGR_ID
			, FRST_REG_DTM
			, LST_MDFR_ID
			, LST_MDF_DTM
			)
		VALUES
			(			
			nextval('q_usrdbaut_i_01')
			, #{db_svr_id}
			, #{db_id}
			, #{user}		
			, 'N'
			, #{usr_id}
			, clock_timestamp()
			, #{usr_id}
			, clock_timestamp()
			)
	</insert>	
	
	<delete id="deleteDbSvrAuthority" parameterType="string">
		/**
		* Query ID : deleteDbSvrAuthority
		* Description : 사용자삭제시, 디비서버권한 삭제
		* Author : 변승우
		**/
		DELETE FROM T_USRDBSVRAUT_I
		WHERE usr_id=#{usr_id}
	</delete>
	
	
	<delete id="deleteDbAuthority" parameterType="string">
		/**
		* Query ID : deleteDbAuthority
		* Description : 사용자삭제시, 디비권한 삭제
		* Author : 변승우
		**/
		DELETE FROM T_USRDBAUT_I
		WHERE usr_id=#{usr_id}
	</delete>		
</mapper>
