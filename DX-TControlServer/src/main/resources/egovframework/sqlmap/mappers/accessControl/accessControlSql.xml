<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="accessControlSql">

	<select id="selectDatabaseList" resultType="dbidbserverVO">
		/**
	 	*  Query ID : selectDatabaseList
	 	* Description : DB 조회
	 	* Author : 김주영
	 	**/ 	
		SELECT 	
			  D.DB_ID
			, D.DB_NM
			, S.DB_SVR_ID
			, S.DB_SVR_NM
			, S.IPADR
			, S.PORTNO
			, S.DFT_DB_NM
			, S.SVR_SPR_USR_ID
			, S.SVR_SPR_SCM_PWD
		FROM T_DB_I D, T_DBSVR_I S, T_USRDBAUT_I A
		WHERE D.DB_SVR_ID=S.DB_SVR_ID
		AND D.DB_ID = A.DB_ID
		AND S.DB_SVR_ID=#{db_svr_id}	  	
		AND D.USEYN = 'Y'
		AND A.AUT_YN = 'Y'
    </select>
    
    <select id="selectServerDb" resultType="dbidbserverVO" parameterType="dbidbserverVO">
		/**
	 	*  Query ID : selectServerDb
	 	* Description : DB,SERVER 조회
	 	* Author : 김주영
	 	**/ 	
		SELECT 
			  D.db_id
			, D.db_nm
			, S.db_svr_id
			, S.db_svr_nm
			, S.ipadr
			, S.portno
			, S.dft_db_nm
			, S.svr_spr_usr_id
			, S.svr_spr_scm_pwd
		FROM T_DB_I D, T_DBSVR_I S
		WHERE D.db_svr_id=S.db_svr_id
		AND D.db_id=#{db_id}
		AND D.USEYN = 'Y'
		LIMIT 1		  	
    </select>
 	   
	<delete id="deleteDbAccessControl" parameterType="int">
       	/**
	 	* Query ID : deleteDbAccessControl
	 	* Description : DB 접근제어 전체 삭제
	 	* Author : 김주영
	 	**/ 	
		DELETE 
		FROM T_SVRACSCNTR_I 
	 	WHERE DB_ID=#{db_id}
	</delete>
	
	<insert id="insertAccessControl" parameterType="accessControlVO">
		/**
	 	*  Query ID : insertAccessControl
	 	* Description : 접근제어 등록
	 	* Author : 김주영
	 	**/
	 	INSERT INTO T_SVRACSCNTR_I
		(
		  SVR_ACS_CNTR_ID
		, DB_SVR_ID
		, DB_ID
		, PRMS_IPADR
		, PRMS_USR_ID
		, PRMS_SEQ
		, PRMS_SET
		, CTF_MTH_NM
		, CTF_TP_NM
		, OPT_NM
		, CMD_CNTS
		, FRST_REGR_ID
		, FRST_REG_DTM
		, LST_MDFR_ID
		, LST_MDF_DTM
		)
		VALUES
		(
		  nextval('q_svracscntr_i_01')
		, #{db_svr_id}
		, #{db_id}
		, #{prms_ipadr}
		, #{prms_usr_id}
		, #{prms_seq}
		, #{prms_set}
		, #{ctf_mth_nm}
		, #{ctf_tp_nm}
		, #{opt_nm}
		, #{cmd_cnts}
		, #{frst_regr_id}
		, clock_timestamp()
		, #{lst_mdfr_id}
		, clock_timestamp()
		) 
	</insert>

</mapper>
