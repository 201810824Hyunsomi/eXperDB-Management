<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="dbserverManagerSql">
	<typeAlias alias="dbServerVO" type="com.k4m.dx.tcontrol.admin.dbserverManager.service.DbServerVO" />

	<select id="selectDbServerList" resultClass="dbServerVO">
		/**
	 	*  Query ID : selectDbServerList
	 	* Description : DB서버 리스트 조회
	 	* Author : 변승우
	 	**/
	 	
	  SELECT
      		(ROW_NUMBER() OVER()) AS ROWNUM
			, (ROW_NUMBER() OVER()) AS IDX
			, A.DB_SVR_ID
			, A.DB_SVR_NM
			, A.IPADR
			, A.PORTNO
			, A.DFT_DB_NM
			, A.SVR_SPR_USR_ID
			, A.SVR_SPR_SCM_PWD
			, A.FRST_REGR_ID
			, A.FRST_REG_DTM
			, A.LST_MDFR_ID
			, A.LST_MDF_DTM
      FROM(      
          SELECT 
                 DB_SVR_ID
                , DB_SVR_NM
                , IPADR
                , PORTNO
                , DFT_DB_NM
                , SVR_SPR_USR_ID
                , SVR_SPR_SCM_PWD
                , FRST_REGR_ID
                , FRST_REG_DTM
                , LST_MDFR_ID
                , LST_MDF_DTM
          FROM T_DBSVR_I	
          WHERE 1 = 1
	      <isNotEmpty property="db_svr_nm">
	      AND DB_SVR_NM LIKE '%' || #db_svr_nm# || '%'
	      </isNotEmpty>
	      <isNotEmpty property="ipadr">
	      AND IPADR LIKE '%' || #ipadr# || '%'
	      </isNotEmpty>
	      <isNotEmpty property="dft_db_nm">
	      AND DFT_DB_NM LIKE  '%' || #dft_db_nm# || '%'
	      </isNotEmpty>          
          ORDER BY DB_SVR_ID
      ) A		
    </select>
    
    
    <insert id="insertDbServer" parameterClass="dbServerVO">
    	/**
	 	*  Query ID : insertDbServer
	 	* Description : insertDbServer 등록
	 	* Author : 변승우
	 	**/
	 	
		INSERT INTO T_DBSVR_I
		(
			  DB_SVR_ID
			, DB_SVR_NM
			, IPADR
			, PORTNO
			, DFT_DB_NM
			, SVR_SPR_USR_ID
			, SVR_SPR_SCM_PWD
			, FRST_REGR_ID
			, FRST_REG_DTM
			, LST_MDFR_ID
			, LST_MDF_DTM
		) 
		VALUES
		(
			  nextval('q_dbsvr_i_01')
			, #db_svr_nm#
			, #ipadr#
			, #portno#
			, #dft_db_nm#
			, #svr_spr_usr_id#
			, #svr_spr_scm_pwd#
			, #frst_regr_id#
			, clock_timestamp()
			, #lst_mdfr_id#
			, clock_timestamp()	
		)
	</insert>    
</sqlMap>